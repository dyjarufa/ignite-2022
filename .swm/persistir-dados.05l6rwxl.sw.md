---
id: 05l6rwxl
title: Persistir Dados
file_version: 1.1.3
app_version: 1.18.21
---

Arquivo respons√°vel por receber o formul√°rio do time-intervals e salvar essas info dentro do BD da tabela User

<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->

### üìÑ src/pages/api/users/time-intervals.api.ts

```typescript
1      /* Arquivo respons√°vel por receber o formul√°rio do time-intervals e salvar essas info dentro do BD da tabela User */
2
3      import { NextApiRequest, NextApiResponse } from 'next'
4      import { getServerSession } from 'next-auth'
5      import { z } from 'zod'
6
7      import { prisma } from '@/lib/prisma'
8
9      import { buildNextAuthOptions } from '../auth/[...nextauth].api'
10
11     const timeIntervalsBodySchema = z.object({
12       intervals: z.array(
13         z.object({
14           weekDay: z.number(),
15           startTimeInMinutes: z.number(),
16           endTimeInMinutes: z.number(),
17         })
18       ),
19     })
20
21     export default async function handler(
22       req: NextApiRequest,
23       res: NextApiResponse
24     ) {
25       if (req.method !== 'POST') {
26         return res.status(405).end()
27       }
28
29       /*
30         Obter informa√ß√µes do usu√°rio logada no Next.Auth
31         ? para pegar informa√ß√µes do usuario do lado do server side:
32         ? https://next-auth.js.org/configuration/nextjs#unstable_getserversession
33       */
34       const session = await getServerSession(
35         req,
36         res,
37         buildNextAuthOptions(req, res) //* passa o req e res para que ele consiga obter informa√ß√µes da sess√£o
38       )
39
40       // console.log(session)
41
42       if (!session) {
43         return res.status(401).end()
44       }
45
46       // * parse retorna os dados tipados e faz uma valida√ß√£o e dispara um erro caso o bady n√£o retorne o formato do schema
47       const { intervals } = timeIntervalsBodySchema.parse(req.body)
48
49       /* existe uma limita√ß√£o do sql lite a qual n√£o permite m√∫ltiplas inser√ß√µes do BD
50         ent√£o vou usar a estrat√©gia de Promise.all para ele fazer inser√ß√£o simult√¢nea
51        */
52       await Promise.all(
53         intervals?.map((interval) => {
54           return prisma.userTimeInterval.create({
55             data: {
56               week_day: interval.weekDay,
57               time_start_in_minutes: interval.startTimeInMinutes,
58               time_end_in_minutes: interval.endTimeInMinutes,
59               user_id: session.user?.id,
60             },
61           })
62         })
63       )
64
65       return res.status(201).end()
```

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBaWduaXRlLTIwMjIlM0ElM0FkeWphcnVmYQ==/docs/05l6rwxl).
