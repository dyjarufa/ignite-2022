---
id: qp0tmhc5
title: BlockedTime and AvailableTimes
file_version: 1.1.3
app_version: 1.18.37
---

o c√≥digo busca no banco de dados todos os hor√°rios que est√£o bloqueados para um usu√°rio dentro de um intervalo de horas espec√≠fico. Depois, ele filtra fora desses hor√°rios bloqueados para encontrar quais hor√°rios ainda est√£o dispon√≠veis

<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->

### üìÑ src/pages/api/users/[username]/availability.api.ts

```typescript
66       const blockedTimes = await prisma.scheduling.findMany({
67         select: {
68           date: true,
69         },
70         where: {
71           user_Id: user.id,
72           date: {
73             gte: referenceDate.set('hour', startHour).toDate(),
74             lte: referenceDate.set('hour', endHour).toDate(),
75           },
76         },
77       })
78
79       const availableTimes = possibleTimes.filter((time) => {
80         return !blockedTimes.some((blockedTime) => {
81           return blockedTime.date.getHours() === time
82         })
83       })
84
85       return res.json({ possibleTimes, availableTimes })
```

<br/>

1.  **Consulta ao Banco de Dados:**

    - `prisma.scheduling.findMany(...)`: Esta chamada ao Prisma busca v√°rios registros na tabela `scheduling`.

    - `select: { date: true }`: Indica que queremos selecionar apenas a coluna `date` dos registros encontrados.

    - `where: { ... }`: Define os crit√©rios de busca. Procuramos agendamentos (`scheduling`) onde:

      - `user_Id: user.id`: O ID do usu√°rio corresponde ao ID do usu√°rio atual.

      - `date: { gte: ..., lte: ... }`: A data do agendamento est√° entre o in√≠cio e o fim do hor√°rio de refer√™ncia.

2.  **Defini√ß√£o de Hor√°rios de Refer√™ncia:**

    - `referenceDate.set('hour', startHour).toDate()`: Define o in√≠cio do per√≠odo de refer√™ncia ajustando a `referenceDate` para a `startHour` e convertendo para um objeto `Date` do JavaScript.

    - `referenceDate.set('hour', endHour).toDate()`: Define o final do per√≠odo de refer√™ncia da mesma maneira, mas com a `endHour`.

3.  **Filtragem de Hor√°rios Dispon√≠veis:**

    - `possibleTime.filter(...)`: Esta fun√ß√£o est√° filtrando o array `possibleTime`, que cont√©m todos os poss√≠veis hor√°rios dispon√≠veis.

    - `!blockedTimes.some(...)`: A fun√ß√£o `some` verifica se algum dos hor√°rios bloqueados (`blockedTimes`) corresponde ao hor√°rio que estamos filtrando (`time`).

      - `blockedTime.date.getHours() === time`: Compara se a hora do hor√°rio bloqueado √© igual ao hor√°rio que estamos verificando.

      - `!`: O sinal de nega√ß√£o indica que queremos manter o hor√°rio em `possibleTime` apenas se ele **n√£o** estiver bloqueado.

4.  **Resposta do Servidor:**

    - `return res.json({ possibleTime, availableTime })`: Envia uma resposta JSON com dois arrays:

      - `possibleTime`: Todos os poss√≠veis hor√°rios.

      - `availableTime`: Apenas os hor√°rios que n√£o est√£o bloqueados e, portanto, est√£o dispon√≠veis.

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBaWduaXRlLTIwMjIlM0ElM0FkeWphcnVmYQ==/docs/qp0tmhc5).
